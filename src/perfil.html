<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerency - Perfil</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        body {
            margin-top: 120px;
        }

        .profile-container {
            max-width: 600px;
            margin: auto;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .profile-icon {
            font-size: 100px;
            color: #26be59;
            margin-bottom: 20px;
            cursor: pointer; 
        }

        .profile-name,
        .profile-email {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .profile-edit-password {
            margin-top: 20px;
        }

        .circle {
            width: 100px;
            height: 100px;
            background-color: #26be59;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <main>
        <nav class="navbar bg-body-tertiary fixed-top">
            <div class="container-fluid">
                <div class="d-flex nav-link">
                    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <img class="logo m-1" src="styles/img/logo.png" alt="">
                    <a class="navbar-brand ms-2 text-secondary" href="home.html">Gerency > <span
                            class="text-dark">Perfil</span></a>
                </div>

                <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                    aria-labelledby="offcanvasNavbarLabel">
                    <div class="offcanvas-header">
                        <button type="button" class="btn-close m-2" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <ul class="navbar-nav">
                            <li class="nav-item m-3">
                                <a href="home.html" class="active">
                                    <span class="me-2">
                                        <i class="bi bi-house-door ms-3"></i>
                                    </span>
                                    <span id="home">Home</span>
                                </a>
                            </li>
                            <li class="nav-item m-3">
                                <a href="historico.html">
                                    <span class="me-2">
                                        <i class="bi bi-clock-history ms-3"></i>
                                    </span>
                                    <span id="historico">Histórico</span>
                                </a>
                            </li>
                            <li class="nav-item m-3">
                                <a href="meta.html">
                                    <span class="me-2">
                                        <i class="bi bi-bookmark-check ms-3"></i>
                                    </span>
                                    <span id="metas">Metas</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container profile-container mt-5">
            <div class="text-center">

                <div class="circle" id="profileCircle"
                    style="align-items: center; justify-content: center; margin-left: 220px;">
                    <button onclick="openFileSelector()"
                        style="width: 100%; height: 100%; border: none; background: none; cursor: pointer;"></button>
                </div>
                <input type="file" id="uploadProfilePic" style="display: none;" accept="image/*"
                    onchange="previewImage(event)">

                <div class="profile-name" id="profileName">Nome</div>
                <div class="profile-email" id="profileEmail">nome@email.com</div>

            </div>
            <hr>
            <div class="profile-edit-password">
                <h5>Alterar Senha</h5>
                <form>
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Senha Atual</label>
                        <input type="password" class="form-control" id="currentPassword" name="currentPassword">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">Nova Senha</label>
                        <input type="password" class="form-control" id="newPassword" name="newPassword">
                    </div>
                    <div class="mb-3">
                        <label for="confirmNewPassword" class="form-label">Confirmar Nova Senha</label>
                        <input type="password" class="form-control" id="confirmNewPassword"
                            name="confirmNewPassword">
                    </div>
                    <button type="submit" class="btn"
                        style="color: #26be59; border: #0000 solid 2px;">Salvar Nova Senha</button>
                </form>
            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadCurrentUser() {
            console.log("Carregando dados do usuário...");
            let currentUserData = JSON.parse(localStorage.getItem('currentUser'));
            console.log("Dados do usuário no localStorage:", currentUserData);
            if (currentUserData) {
                let profileNameElement = document.getElementById('profileName');
                let profileEmailElement = document.getElementById('profileEmail');
                if (profileNameElement && profileEmailElement) {
                    console.log("Elementos de perfil encontrados. Atualizando dados...");
                    profileNameElement.innerText = currentUserData.name;
                    profileEmailElement.innerText = currentUserData.email;
                } else {
                    console.error('Elementos de perfil não encontrados.');
                }
                // verifica se tem uma imagem de perfil no currentUser e a exibe
                if (currentUserData.profileImage) {
                    let profileCircle = document.getElementById('profileCircle');
                    profileCircle.style.backgroundImage = 'url(' + currentUserData.profileImage + ')';
                    profileCircle.style.backgroundSize = 'cover';
                }
            } else {
                console.error('Dados do usuário atual não encontrados no localStorage.');
            }
        }

        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function () {
                var output = document.getElementById('profileCircle');
                output.style.backgroundImage = 'url(' + reader.result + ')';
                output.style.backgroundSize = 'cover';

                // salva a imagem no currentUser do localStorage
                let currentUserData = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUserData) {
                    currentUserData.profileImage = reader.result;
                    localStorage.setItem('currentUser', JSON.stringify(currentUserData));
                }
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function openFileSelector() {
            document.getElementById('uploadProfilePic').click();
        }

        // carrega as informações do usuário atualmente logado quando a página carrega
        window.onload = function () {
            loadCurrentUser();

            // event listener para o clique no ícone de perfil
            document.getElementById('profileCircle').addEventListener('click', openFileSelector);
        };
    </script>
</body>

</html>
